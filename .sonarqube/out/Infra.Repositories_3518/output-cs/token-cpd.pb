‰
8D:\Dev\AspNetCoreTestes\Repositories\ClienteRepositoy.cs
	namespace 	
Repositories
 
{ 
public 

class 
ClienteRepository "
:# $

Repository% /
</ 0
Cliente0 7
,7 8
LojaContext9 D
>D E
,E F
IClienteRepositoryG Y
{		 
public

 
ClienteRepository

  
(

  !
LojaContext

! ,
context

- 4
)

4 5
:

6 7
base

8 <
(

< =
context

= D
)

D E
{ 	
} 	
} 
} á
=D:\Dev\AspNetCoreTestes\Repositories\Contexts\AdminContext.cs
	namespace

 	
Infra


 
.

 
Repositories

 
.

 
Contexts

 %
{ 
public 

class 
AdminContext 
: 
	DbContext  )
{ 
public 
DbSet 
< 
Usuario 
> 
Usuarios &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
AdminContext 
( 
DbContextOptions ,
<, -
AdminContext- 9
>9 :
options; B
)B C
:D E
baseF J
(J K
optionsK R
)R S
=>T V
ChangeTracker 
. !
QueryTrackingBehavior /
=0 1!
QueryTrackingBehavior2 G
.G H

NoTrackingH R
;R S
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
.  
AddDefaultProperties %
(% &
)& '
. 
Entity 
< 
Usuario 
>  
(  !
entity! '
=>( *
{ 
entity   
.!! 
ToTable!! 
(!! 
$str!! &
)!!& '
."" 
AddIsDeletedFilter"" '
(""' (
)""( )
;"") *
}## 
)## 
;## 
}&& 	
public** 
override** 
int** 
SaveChanges** '
(**' (
)**( )
{++ 	#
DefaultPropertiesConfig,, #
.,,# $(
SaveDefaultPropertiesChanges,,$ @
(,,@ A
ChangeTracker,,A N
),,N O
;,,O P
return-- 
base-- 
.-- 
SaveChanges-- #
(--# $
)--$ %
;--% &
}.. 	
}// 
}00 ô
MD:\Dev\AspNetCoreTestes\Repositories\Contexts\Config\AdminDbContextFactory.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
{ 
public		 

class		 !
AdminDbContextFactory		 &
:		' ('
IDesignTimeDbContextFactory		) D
<		D E
AdminContext		E Q
>		Q R
{

 
public 
AdminContext 
CreateDbContext +
(+ ,
string, 2
[2 3
]3 4
args5 9
)9 :
{ 	
var 
builder 
= 
new #
DbContextOptionsBuilder 5
<5 6
AdminContext6 B
>B C
(C D
)D E
;E F
builder 
. 
UseSqlServer  
(  !
$str! |
)| }
;} ~
return 
new 
AdminContext #
(# $
builder$ +
.+ ,
Options, 3
)3 4
;4 5
} 	
} 
} ¸!
OD:\Dev\AspNetCoreTestes\Repositories\Contexts\Config\DefaultPropertiesConfig.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
.% &
Config& ,
{ 
public 

static 
class #
DefaultPropertiesConfig /
{ 
internal 
static 
ModelBuilder $ 
AddDefaultProperties% 9
(9 :
this: >
ModelBuilder? K
modelBuilderL X
)X Y
{ 	
foreach 
( 
var 

entityType #
in$ &
modelBuilder' 3
.3 4
Model4 9
.9 :
GetEntityTypes: H
(H I
)I J
)J K
{ 
modelBuilder 
. 
Entity #
(# $

entityType$ .
.. /
Name/ 3
)3 4
.4 5
Property5 =
<= >
DateTime> F
>F G
(G H
$strH V
)V W
;W X
modelBuilder 
. 
Entity #
(# $

entityType$ .
.. /
Name/ 3
)3 4
.4 5
Property5 =
<= >
bool> B
>B C
(C D
$strD O
)O P
;P Q
} 
return 
modelBuilder 
;  
} 	
internal 
static 
EntityTypeBuilder )
AddIsDeletedFilter* <
<< =
T= >
>> ?
(? @
this@ D
EntityTypeBuilderE V
<V W
TW X
>X Y
entityTypeBuilderZ k
)k l
wherem r
Ts t
:t u
Entityu {
{ 	
entityTypeBuilder 
. 
HasQueryFilter ,
(, -
c- .
=>/ 1
!2 3
EF3 5
.5 6
Property6 >
<> ?
bool? C
>C D
(D E
cE F
,F G
$strH S
)S T
)T U
;U V
return 
entityTypeBuilder $
;$ %
} 	
internal 
static 
void (
SaveDefaultPropertiesChanges 9
(9 :
ChangeTracker: G
changeTrackerH U
)U V
{   	
foreach!! 
(!! 
var!! 
entry!! 
in!! !
changeTracker!!" /
.!!/ 0
Entries!!0 7
(!!7 8
)!!8 9
."" 
Where"" 
("" 
e"" 
=>"" 
e"" 
."" 
State""  
==""! #
EntityState""$ /
.""/ 0
Added""0 5
||""6 8
e## 
.## 
State##  
==##! #
EntityState##$ /
.##/ 0
Modified##0 8
)##8 9
)##9 :
{$$ 
entry%% 
.%% 
Property%% 
(%% 
$str%% -
)%%- .
.%%. /
CurrentValue%%/ ;
=%%< =
DateTime%%> F
.%%F G
Now%%G J
;%%J K
}&& 
foreach(( 
((( 
var(( 
entry(( 
in(( !
changeTracker((" /
.((/ 0
Entries((0 7
(((7 8
)((8 9
.)) 
Where)) 
()) 
p)) 
=>)) 
p)) 
.)) 
State)) !
==))" $
EntityState))% 0
.))0 1
Deleted))1 8
&&** 
p** 
.** 
Entity** 
is** 
Entity** #
)**# $
)**$ %
{++ 
entry,, 
.,, 
Property,, 
(,, 
$str,, *
),,* +
.,,+ ,
CurrentValue,,, 8
=,,9 :
true,,; ?
;,,? @
entry-- 
.-- 
State-- 
=-- 
EntityState-- )
.--) *
Modified--* 2
;--2 3
}.. 
}// 	
}00 
}11 î
LD:\Dev\AspNetCoreTestes\Repositories\Contexts\Config\LojaDbContextFactory.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
{		 
public

 

class

  
LojaDbContextFactory

 %
:

& ''
IDesignTimeDbContextFactory

( C
<

C D
LojaContext

D O
>

O P
{ 
public 
LojaContext 
CreateDbContext *
(* +
string+ 1
[1 2
]2 3
args4 8
)8 9
{ 	
var 
builder 
= 
new #
DbContextOptionsBuilder 5
<5 6
LojaContext6 A
>A B
(B C
)C D
;D E
builder 
. 
UseSqlServer  
(  !
$str! |
)| }
;} ~
return 
new 
LojaContext "
(" #
builder# *
.* +
Options+ 2
)2 3
;3 4
} 	
} 
} õ
<D:\Dev\AspNetCoreTestes\Repositories\Contexts\LojaContext.cs
	namespace		 	
Infra		
 
.		 
Repositories		 
.		 
Contexts		 %
{

 
public 

class 
LojaContext 
: 
	DbContext (
{ 
public 
DbSet 
< 
Cliente 
> 
Clientes &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
DbSet 
< 
Pedido 
> 
Pedidos $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DbSet 
< 
Produto 
> 
Produto %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
DbSet 
< 
ItensPedido  
>  !

ItemPedido" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
LojaContext 
( 
DbContextOptions +
<+ ,
LojaContext, 7
>7 8
options9 @
)@ A
:B C
baseD H
(H I
optionsI P
)P Q
=>R T
ChangeTracker 
. !
QueryTrackingBehavior /
=0 1!
QueryTrackingBehavior2 G
.G H

NoTrackingH R
;R S
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
.  
AddDefaultProperties %
(% &
)& '
.   
Entity   
<   
Cliente   
>    
(    !
entity  ! '
=>  ( *
{!! 
entity"" 
.## 
ToTable## 
(## 
$str## &
)##& '
.$$ 
AddIsDeletedFilter$$ '
($$' (
)$$( )
;$$) *
}%% 
)%% 
.'' 
Entity'' 
<'' 
Pedido'' 
>'' 
(''  
entity''  &
=>''' )
{(( 
entity)) 
.** 
ToTable** 
(** 
$str** %
)**% &
.++ 
AddIsDeletedFilter++ '
(++' (
)++( )
;++) *
},, 
),, 
... 
Entity.. 
<.. 
Produto.. 
>..  
(..  !
entity..! '
=>..( *
{// 
entity00 
.11 
ToTable11 
(11 
$str11 &
)11& '
.22 
AddIsDeletedFilter22 '
(22' (
)22( )
;22) *
}33 
)33 
.55 
Entity55 
<55 
ItensPedido55 #
>55# $
(55$ %
entity55% +
=>55, .
{66 
entity77 
.88 
ToTable88 
(88 
$str88 )
)88) *
.99 
HasKey99 
(99 
x99 
=>99  
new99! $
{99% &
x99' (
.99( )
PedidoId99) 1
,991 2
x993 4
.994 5
	ProdutoId995 >
}99? @
)99@ A
;99A B
}:: 
):: 
;;; 
}== 	
publicAA 
overrideAA 
intAA 
SaveChangesAA '
(AA' (
)AA( )
{BB 	#
DefaultPropertiesConfigDD #
.DD# $(
SaveDefaultPropertiesChangesDD$ @
(DD@ A
ChangeTrackerDDA N
)DDN O
;DDO P
returnEE 
baseEE 
.EE 
SaveChangesEE #
(EE# $
)EE$ %
;EE% &
}FF 	
}GG 
}HH ƒ
MD:\Dev\AspNetCoreTestes\Repositories\EventHandlers\UserCreatedEventHandler.cs
	namespace 	
Repositories
 
. 
EventHandlers $
{ 
public		 

class		 #
UserCreatedEventHandler		 (
:		) *
IHandle		+ 2
<		2 3
UsuarioCriadoEvent		3 E
>		E F
{

 
public 
void 
Handle 
( 
UsuarioCriadoEvent -
args. 2
)2 3
{ 	
Logger 
. 
Log 
( 
$" G
;Peguei o User Created Event No Repositorio. O usuario Ã© o  S
{S T
argsT X
.X Y
UsuarioY `
.` a
Nomea e
}e f
.f g
"g h
)h i
;i j
} 	
} 
} 
FD:\Dev\AspNetCoreTestes\Repositories\Migrations\20170901175758_init.cs
	namespace 	
Infra
 
. 
Repositories 
. 

Migrations '
{ 
public 

partial 
class 
init 
: 
	Migration  )
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ G
,G H,
 SqlServerValueGenerationStrategyI i
.i j
IdentityColumnj x
)x y
,y z
	IsDeleted 
= 
table  %
.% &
Column& ,
<, -
bool- 1
>1 2
(2 3
type3 7
:7 8
$str9 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
LastModified  
=! "
table# (
.( )
Column) /
</ 0
DateTime0 8
>8 9
(9 :
type: >
:> ?
$str@ K
,K L
nullableM U
:U V
falseW \
)\ ]
,] ^
Nome 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
trueQ U
)U V
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Id: <
)< =
;= >
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
)  
;  !
}   	
}!! 
}"" ‚a
KD:\Dev\AspNetCoreTestes\Repositories\Migrations\Loja\20170901183731_init.cs
	namespace 	
Infra
 
. 
Repositories 
. 

Migrations '
.' (
Loja( ,
{ 
public 

partial 
class 
init 
: 
	Migration  )
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ G
,G H,
 SqlServerValueGenerationStrategyI i
.i j
IdentityColumnj x
)x y
,y z
	IsDeleted 
= 
table  %
.% &
Column& ,
<, -
bool- 1
>1 2
(2 3
type3 7
:7 8
$str9 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
LastModified  
=! "
table# (
.( )
Column) /
</ 0
DateTime0 8
>8 9
(9 :
type: >
:> ?
$str@ K
,K L
nullableM U
:U V
falseW \
)\ ]
,] ^
Nome 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
trueQ U
)U V
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Id: <
)< =
;= >
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
.   

Annotation   #
(  # $
$str  $ G
,  G H,
 SqlServerValueGenerationStrategy  I i
.  i j
IdentityColumn  j x
)  x y
,  y z
	IsDeleted!! 
=!! 
table!!  %
.!!% &
Column!!& ,
<!!, -
bool!!- 1
>!!1 2
(!!2 3
type!!3 7
:!!7 8
$str!!9 >
,!!> ?
nullable!!@ H
:!!H I
false!!J O
)!!O P
,!!P Q
LastModified""  
=""! "
table""# (
.""( )
Column"") /
<""/ 0
DateTime""0 8
>""8 9
(""9 :
type"": >
:""> ?
$str""@ K
,""K L
nullable""M U
:""U V
false""W \
)""\ ]
,""] ^
Nome## 
=## 
table##  
.##  !
Column##! '
<##' (
string##( .
>##. /
(##/ 0
type##0 4
:##4 5
$str##6 E
,##E F
nullable##G O
:##O P
true##Q U
)##U V
,##V W
Preco$$ 
=$$ 
table$$ !
.$$! "
Column$$" (
<$$( )
decimal$$) 0
>$$0 1
($$1 2
type$$2 6
:$$6 7
$str$$8 H
,$$H I
nullable$$J R
:$$R S
false$$T Y
)$$Y Z
}%% 
,%% 
constraints&& 
:&& 
table&& "
=>&&# %
{'' 
table(( 
.(( 

PrimaryKey(( $
((($ %
$str((% 1
,((1 2
x((3 4
=>((5 7
x((8 9
.((9 :
Id((: <
)((< =
;((= >
})) 
))) 
;)) 
migrationBuilder++ 
.++ 
CreateTable++ (
(++( )
name,, 
:,, 
$str,, 
,,, 
columns-- 
:-- 
table-- 
=>-- !
new--" %
{.. 
Id// 
=// 
table// 
.// 
Column// %
<//% &
int//& )
>//) *
(//* +
type//+ /
:/// 0
$str//1 6
,//6 7
nullable//8 @
://@ A
false//B G
)//G H
.00 

Annotation00 #
(00# $
$str00$ G
,00G H,
 SqlServerValueGenerationStrategy00I i
.00i j
IdentityColumn00j x
)00x y
,00y z
	ClienteId11 
=11 
table11  %
.11% &
Column11& ,
<11, -
int11- 0
>110 1
(111 2
type112 6
:116 7
$str118 =
,11= >
nullable11? G
:11G H
true11I M
)11M N
,11N O
	IsDeleted22 
=22 
table22  %
.22% &
Column22& ,
<22, -
bool22- 1
>221 2
(222 3
type223 7
:227 8
$str229 >
,22> ?
nullable22@ H
:22H I
false22J O
)22O P
,22P Q
LastModified33  
=33! "
table33# (
.33( )
Column33) /
<33/ 0
DateTime330 8
>338 9
(339 :
type33: >
:33> ?
$str33@ K
,33K L
nullable33M U
:33U V
false33W \
)33\ ]
}44 
,44 
constraints55 
:55 
table55 "
=>55# %
{66 
table77 
.77 

PrimaryKey77 $
(77$ %
$str77% 0
,770 1
x772 3
=>774 6
x777 8
.778 9
Id779 ;
)77; <
;77< =
table88 
.88 

ForeignKey88 $
(88$ %
name99 
:99 
$str99 ;
,99; <
column:: 
::: 
x::  !
=>::" $
x::% &
.::& '
	ClienteId::' 0
,::0 1
principalTable;; &
:;;& '
$str;;( 1
,;;1 2
principalColumn<< '
:<<' (
$str<<) -
,<<- .
onDelete==  
:==  !
ReferentialAction==" 3
.==3 4
Restrict==4 <
)==< =
;=== >
}>> 
)>> 
;>> 
migrationBuilder@@ 
.@@ 
CreateTable@@ (
(@@( )
nameAA 
:AA 
$strAA "
,AA" #
columnsBB 
:BB 
tableBB 
=>BB !
newBB" %
{CC 
PedidoIdDD 
=DD 
tableDD $
.DD$ %
ColumnDD% +
<DD+ ,
intDD, /
>DD/ 0
(DD0 1
typeDD1 5
:DD5 6
$strDD7 <
,DD< =
nullableDD> F
:DDF G
falseDDH M
)DDM N
,DDN O
	ProdutoIdEE 
=EE 
tableEE  %
.EE% &
ColumnEE& ,
<EE, -
intEE- 0
>EE0 1
(EE1 2
typeEE2 6
:EE6 7
$strEE8 =
,EE= >
nullableEE? G
:EEG H
falseEEI N
)EEN O
,EEO P
	IsDeletedFF 
=FF 
tableFF  %
.FF% &
ColumnFF& ,
<FF, -
boolFF- 1
>FF1 2
(FF2 3
typeFF3 7
:FF7 8
$strFF9 >
,FF> ?
nullableFF@ H
:FFH I
falseFFJ O
)FFO P
,FFP Q
LastModifiedGG  
=GG! "
tableGG# (
.GG( )
ColumnGG) /
<GG/ 0
DateTimeGG0 8
>GG8 9
(GG9 :
typeGG: >
:GG> ?
$strGG@ K
,GGK L
nullableGGM U
:GGU V
falseGGW \
)GG\ ]
,GG] ^

QuantidadeHH 
=HH  
tableHH! &
.HH& '
ColumnHH' -
<HH- .
intHH. 1
>HH1 2
(HH2 3
typeHH3 7
:HH7 8
$strHH9 >
,HH> ?
nullableHH@ H
:HHH I
falseHHJ O
)HHO P
}II 
,II 
constraintsJJ 
:JJ 
tableJJ "
=>JJ# %
{KK 
tableLL 
.LL 

PrimaryKeyLL $
(LL$ %
$strLL% 4
,LL4 5
xLL6 7
=>LL8 :
newLL; >
{LL? @
xLLA B
.LLB C
PedidoIdLLC K
,LLK L
xLLM N
.LLN O
	ProdutoIdLLO X
}LLY Z
)LLZ [
;LL[ \
tableMM 
.MM 

ForeignKeyMM $
(MM$ %
nameNN 
:NN 
$strNN =
,NN= >
columnOO 
:OO 
xOO  !
=>OO" $
xOO% &
.OO& '
PedidoIdOO' /
,OO/ 0
principalTablePP &
:PP& '
$strPP( 0
,PP0 1
principalColumnQQ '
:QQ' (
$strQQ) -
,QQ- .
onDeleteRR  
:RR  !
ReferentialActionRR" 3
.RR3 4
CascadeRR4 ;
)RR; <
;RR< =
tableSS 
.SS 

ForeignKeySS $
(SS$ %
nameTT 
:TT 
$strTT ?
,TT? @
columnUU 
:UU 
xUU  !
=>UU" $
xUU% &
.UU& '
	ProdutoIdUU' 0
,UU0 1
principalTableVV &
:VV& '
$strVV( 1
,VV1 2
principalColumnWW '
:WW' (
$strWW) -
,WW- .
onDeleteXX  
:XX  !
ReferentialActionXX" 3
.XX3 4
CascadeXX4 ;
)XX; <
;XX< =
}YY 
)YY 
;YY 
migrationBuilder[[ 
.[[ 
CreateIndex[[ (
([[( )
name\\ 
:\\ 
$str\\ /
,\\/ 0
table]] 
:]] 
$str]] #
,]]# $
column^^ 
:^^ 
$str^^ #
)^^# $
;^^$ %
migrationBuilder`` 
.`` 
CreateIndex`` (
(``( )
nameaa 
:aa 
$straa +
,aa+ ,
tablebb 
:bb 
$strbb 
,bb  
columncc 
:cc 
$strcc #
)cc# $
;cc$ %
}dd 	
	protectedff 
overrideff 
voidff 
Downff  $
(ff$ %
MigrationBuilderff% 5
migrationBuilderff6 F
)ffF G
{gg 	
migrationBuilderhh 
.hh 
	DropTablehh &
(hh& '
nameii 
:ii 
$strii "
)ii" #
;ii# $
migrationBuilderkk 
.kk 
	DropTablekk &
(kk& '
namell 
:ll 
$strll 
)ll 
;ll  
migrationBuildernn 
.nn 
	DropTablenn &
(nn& '
nameoo 
:oo 
$stroo 
)oo  
;oo  !
migrationBuilderqq 
.qq 
	DropTableqq &
(qq& '
namerr 
:rr 
$strrr 
)rr  
;rr  !
}ss 	
}tt 
}uu µ	
8D:\Dev\AspNetCoreTestes\Repositories\PedidoRepository.cs
	namespace 	
Repositories
 
{		 
public

 

class

 
PedidoRepository

 !
:

" #

Repository

$ .
<

. /
Pedido

/ 5
,

5 6
LojaContext

7 B
>

B C
,

C D
IPedidoRepository

E V
{ 
public 
PedidoRepository 
(  
LojaContext  +
context, 3
)3 4
:5 6
base7 ;
(; <
context< C
)C D
{ 	
} 	
public 
IList 
< 
Pedido 
> "
ObterPedidosPorCliente 3
(3 4
int4 7
	idCliente8 A
)A B
{ 	
return 
DbSet 
. 
Where 
( 
p  
=>! #
p$ %
.% &
Cliente& -
.- .
Id. 0
==1 3
	idCliente4 =
)= >
.> ?
ToList? E
(E F
)F G
;G H
} 	
} 
} ‰
8D:\Dev\AspNetCoreTestes\Repositories\ProdutoRepositoy.cs
	namespace 	
Repositories
 
{ 
public 

class 
ProdutoRepository "
:# $

Repository% /
</ 0
Produto0 7
,7 8
LojaContext9 D
>D E
,E F
IProdutoRepositoryG Y
{		 
public

 
ProdutoRepository

  
(

  !
LojaContext

! ,
context

- 4
)

4 5
:

6 7
base

8 <
(

< =
context

= D
)

D E
{ 	
} 	
} 
} ¯7
2D:\Dev\AspNetCoreTestes\Repositories\Repository.cs
	namespace

 	
Repositories


 
{ 
public 

abstract 
class 

Repository $
<$ %
TEntity% ,
,, -
TContext. 6
>6 7
:8 9
IRepository: E
<E F
TEntityF M
>M N
,N O
IDisposableP [
where 
TEntity 
: 
Entity 
where 
TContext 
: 
	DbContext "
{ 
	protected 
TContext 
Db 
; 
	protected 
DbSet 
< 
TEntity 
>  
DbSet! &
;& '
	protected 

Repository 
( 
TContext %
context& -
)- .
{ 	
Db 
= 
context 
; 
DbSet 
= 
Db 
. 
Set 
< 
TEntity "
>" #
(# $
)$ %
;% &
} 	
public 
virtual 
TEntity 
GetById &
(& '
int' *
id+ -
)- .
{ 	
return 
DbSet 
. 
AsNoTracking %
(% &
)& '
. 
FirstOrDefault 
(  
c  !
=>" $
c% &
.& '
Id' )
==* ,
id- /
)/ 0
;0 1
} 	
public 
IList 
< 
TEntity 
> 
GetAllBy &
(& '

Expression' 1
<1 2
Func2 6
<6 7
TEntity7 >
,> ?
bool@ D
>D E
>E F
	predicateG P
)P Q
{ 	
return   
DbSet   
.   
AsNoTracking   %
(  % &
)  & '
.!! 
Where!! 
(!! 
	predicate!!  
)!!  !
.!!! "
ToList!!" (
(!!( )
)!!) *
;!!* +
}"" 	
public$$ 
PaginatedResults$$ 
<$$  
TEntity$$  '
>$$' (
GetAllBy$$) 1
($$1 2

Expression$$2 <
<$$< =
Func$$= A
<$$A B
TEntity$$B I
,$$I J
bool$$K O
>$$O P
>$$P Q
	predicate$$R [
,$$[ \
PaginationInput$$] l
paginationInput$$m |
)$$| }
{%% 	
var&& 
count&& 
=&& 
DbSet&& 
.&& 
Where&& #
(&&# $
	predicate&&$ -
)&&- .
.&&. /
Count&&/ 4
(&&4 5
)&&5 6
;&&6 7
var(( 
results(( 
=(( 
DbSet(( 
.((  
AsNoTracking((  ,
(((, -
)((- .
.)) 
Where)) 
()) 
	predicate))  
)))  !
.** 
Skip** 
(** 
paginationInput** %
.**% &
RecordsToSkip**& 3
)**3 4
.++ 
Take++ 
(++ 
paginationInput++ %
.++% &
RecordsPerPage++& 4
)++4 5
.,, 
ToList,, 
(,, 
),, 
;,, 
return.. 
new.. 
PaginatedResults.. '
<..' (
TEntity..( /
>../ 0
(..0 1
results// 
:// 
results//  
,//  !
totalRecords00 
:00 
count00 #
,00# $
currentPage11 
:11 
paginationInput11 ,
.11, -
CurrentPage11- 8
,118 9
recordsPerPage22 
:22 
paginationInput22  /
.22/ 0
RecordsPerPage220 >
)22> ?
;22? @
}33 	
public55 
PaginatedResults55 
<55  
TEntity55  '
>55' (
GetAll55) /
(55/ 0
PaginationInput550 ?
paginationInput55@ O
)55O P
{66 	
var88 
count88 
=88 
DbSet88 
.88 
Count88 #
(88# $
)88$ %
;88% &
var:: 
results:: 
=:: 
DbSet:: 
.::  
AsNoTracking::  ,
(::, -
)::- .
.;; 
Skip;; 
(;; 
paginationInput;; %
.;;% &
RecordsToSkip;;& 3
);;3 4
.<< 
Take<< 
(<< 
paginationInput<< %
.<<% &
RecordsPerPage<<& 4
)<<4 5
.== 
ToList== 
(== 
)== 
;== 
return?? 
new?? 
PaginatedResults?? '
<??' (
TEntity??( /
>??/ 0
(??0 1
results@@ 
:@@ 
results@@  
,@@  !
totalRecordsAA 
:AA 
countAA #
,AA# $
currentPageBB 
:BB 
paginationInputBB ,
.BB, -
CurrentPageBB- 8
,BB8 9
recordsPerPageCC 
:CC 
paginationInputCC  /
.CC/ 0
RecordsPerPageCC0 >
)CC> ?
;CC? @
}DD 	
publicFF 
virtualFF 
voidFF 
InsertFF "
(FF" #
TEntityFF# *
entityFF+ 1
)FF1 2
{GG 	
DbSetHH 
.HH 
AddHH 
(HH 
entityHH 
)HH 
;HH 
DbII 
.II 
SaveChangesII 
(II 
)II 
;II 
}JJ 	
publicLL 
virtualLL 
voidLL 
UpdateLL "
(LL" #
TEntityLL# *
entityLL+ 1
)LL1 2
{MM 	
DbSetNN 
.NN 
UpdateNN 
(NN 
entityNN 
)NN  
;NN  !
DbOO 
.OO 
SaveChangesOO 
(OO 
)OO 
;OO 
}PP 	
publicRR 
virtualRR 
voidRR 
DeleteRR "
(RR" #
TEntityRR# *
entityRR+ 1
)RR1 2
{SS 	
DbSetTT 
.TT 
RemoveTT 
(TT 
entityTT 
)TT  
;TT  !
DbUU 
.UU 
SaveChangesUU 
(UU 
)UU 
;UU 
}VV 	
publicXX 
voidXX 
DisposeXX 
(XX 
)XX 
{YY 	
DbZZ 
.ZZ 
DisposeZZ 
(ZZ 
)ZZ 
;ZZ 
GC[[ 
.[[ 
SuppressFinalize[[ 
([[  
this[[  $
)[[$ %
;[[% &
}\\ 	
}^^ 
}__ Œ
9D:\Dev\AspNetCoreTestes\Repositories\UsuarioRepository.cs
	namespace 	
Repositories
 
{ 
public 

class 
UsuarioRepository "
:# $

Repository% /
</ 0
Usuario0 7
,7 8
AdminContext9 E
>E F
,F G
IUsuarioRepositoryH Z
{		 
public

 
UsuarioRepository

  
(

  !
AdminContext

! -
context

. 5
)

5 6
:

7 8
base

9 =
(

= >
context

> E
)

E F
{ 	
} 	
} 
} 