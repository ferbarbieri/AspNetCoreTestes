¨
3D:\Dev\AspNetCoreTestes\SharedKernel\DomainEvent.cs
	namespace 	
SharedKernel
 
{ 
public 

static 
class 
DomainEvents $
{		 
[

 	
ThreadStatic

	 
]

 
private 
static 
List 
< 
Delegate $
>$ %
actions& -
;- .
static 
DomainEvents 
( 
) 
{ 	
	Container 
= 
ContainerFactory (
.( )
	Container) 2
;2 3
} 	
public 
static 
	Container 
	Container  )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
static 
void 
Register #
<# $
T$ %
>% &
(& '
Action' -
<- .
T. /
>/ 0
callback1 9
)9 :
where; @
TA B
:C D
IDomainEventE Q
{ 	
if 
( 
actions 
== 
null 
)  
{ 
actions 
= 
new 
List "
<" #
Delegate# +
>+ ,
(, -
)- .
;. /
} 
actions 
. 
Add 
( 
callback  
)  !
;! "
} 	
public 
static 
void 
ClearCallbacks )
() *
)* +
{ 	
actions 
= 
null 
; 
} 	
public!! 
static!! 
void!! 
Raise!!  
<!!  !
T!!! "
>!!" #
(!!# $
T!!$ %
args!!& *
)!!* +
where!!, 1
T!!2 3
:!!4 5
IDomainEvent!!6 B
{"" 	
foreach## 
(## 
var## 
handler##  
in##! #
	Container##$ -
.##- .
GetAllInstances##. =
<##= >
IHandle##> E
<##E F
T##F G
>##G H
>##H I
(##I J
)##J K
)##K L
{$$ 
handler%% 
.%% 
Handle%% 
(%% 
args%% #
)%%# $
;%%$ %
}&& 
if(( 
((( 
actions(( 
!=(( 
null(( 
)((  
{)) 
foreach** 
(** 
var** 
action** #
in**$ &
actions**' .
)**. /
{++ 
if,, 
(,, 
action,, 
is,, !
Action,," (
<,,( )
T,,) *
>,,* +
),,+ ,
{-- 
(.. 
(.. 
Action..  
<..  !
T..! "
>.." #
)..# $
action..$ *
)..* +
(..+ ,
args.., 0
)..0 1
;..1 2
}// 
}00 
}11 
}22 	
}33 
}44 ƒ
LD:\Dev\AspNetCoreTestes\SharedKernel\Exceptions\FieldsValidationException.cs
	namespace 	
Domain
 
. 
SharedKernel 
. 

Exceptions (
{ 
[		 
Serializable		 
]		 
public

 

class

 %
FieldsValidationException

 *
:

+ ,
	Exception

- 6
{ 
public 
IList 
< 
FieldValidationInfo (
>( )
FieldsValidation* :
{; <
get= @
;@ A
privateB I
setJ M
;M N
}O P
public %
FieldsValidationException (
(( )
string) /
message0 7
)7 8
:9 :
base; ?
(? @
message@ G
)G H
{ 	
FieldsValidation 
= 
new "
List# '
<' (
FieldValidationInfo( ;
>; <
(< =
)= >
;> ?
FieldsValidation 
. 
Add  
(  !
new! $
FieldValidationInfo% 8
(8 9
$str9 ;
,; <
message= D
,D E
falseF K
)K L
)L M
;M N
} 	
public %
FieldsValidationException (
(( )
string) /
message0 7
,7 8
IList9 >
<> ?
FieldValidationInfo? R
>R S
fieldsValidationT d
)d e
:f g
baseh l
(l m
messagem t
)t u
{ 	
this 
. 
FieldsValidation !
=" #
fieldsValidation$ 4
;4 5
} 	
public 
override 
string 
Message &
=>' )
GetErrorSummary* 9
(9 :
): ;
;; <
private 
string 
GetErrorSummary &
(& '
)' (
{ 	
StringBuilder 
sb 
= 
new "
StringBuilder# 0
(0 1
)1 2
;2 3
sb 
. 
Append 
( 
$str I
)I J
;J K
foreach!! 
(!! 
var!! 
val!! 
in!! 
FieldsValidation!! /
.!!/ 0
Where!!0 5
(!!5 6
c!!6 7
=>!!8 :
!!!; <
c!!< =
.!!= >
IsValid!!> E
)!!E F
)!!F G
{"" 
sb## 
.## 
Append## 
(## 
$"## 
{## 
val##  
.##  !
Field##! &
}##& '
 : ##' *
{##* +
val##+ .
.##. /
Message##/ 6
}##6 7
\n##7 9
"##9 :
)##: ;
;##; <
}$$ 
return%% 
sb%% 
.%% 
ToString%% 
(%% 
)%%  
;%%  !
}&& 	
}'' 
}(( Ú	
DD:\Dev\AspNetCoreTestes\SharedKernel\Exceptions\NotFoundException.cs
	namespace 	
Domain
 
. 
SharedKernel 
. 

Exceptions (
{ 
[ 
Serializable 
] 
public		 

class		 
NotFoundException		 "
:		# $
	Exception		% .
{

 
public 
int 
Id 
{ 
get 
; 
private $
set% (
;( )
}* +
public 
NotFoundException  
(  !
)! "
{ 	
} 	
public 
NotFoundException  
(  !
int! $
id% '
)' (
{ 	
Id 
= 
id 
; 
} 	
public 
NotFoundException  
(  !
string! '
message( /
,/ 0
int1 4
id5 7
)7 8
:9 :
base; ?
(? @
message@ G
)G H
{ 	
Id 
= 
id 
; 
} 	
} 
} â
4D:\Dev\AspNetCoreTestes\SharedKernel\IDomainEvent.cs
	namespace 	
SharedKernel
 
{ 
public 

	interface 
IDomainEvent !
{		 
} 
} Ô
/D:\Dev\AspNetCoreTestes\SharedKernel\IHandle.cs
	namespace 	
SharedKernel
 
{ 
public 

	interface 
IHandle 
< 
in 
T  !
>! "
where# (
T) *
:+ ,
IDomainEvent- 9
{ 
void		 
Handle		 
(		 
T		 
args		 
)		 
;		 
}

 
} ˆ"
.D:\Dev\AspNetCoreTestes\SharedKernel\Logger.cs
	namespace 	
SharedKernel
 
{		 
public

 

static

 
class

 
Logger

 
{ 
private 
static 
readonly 
NLog  $
.$ %
Logger% +
_logger, 3
;3 4
static 
Logger 
( 
) 
{ 	
var 
config 
= 
new  
LoggingConfiguration 1
(1 2
)2 3
;3 4
var 
consoleTarget 
= 
new  # 
ColoredConsoleTarget$ 8
(8 9
)9 :
;: ;
config 
. 
	AddTarget 
( 
$str &
,& '
consoleTarget( 5
)5 6
;6 7
var 

fileTarget 
= 
new  

FileTarget! +
(+ ,
), -
;- .
config 
. 
	AddTarget 
( 
$str #
,# $

fileTarget% /
)/ 0
;0 1
consoleTarget 
. 
Layout  
=! "
$str# T
;T U

fileTarget 
. 
FileName 
=  !
$str" 7
;7 8

fileTarget   
.   
Layout   
=   
$str    Q
;  Q R

fileTarget!! 
.!! 
ArchiveFileName!! &
=!!' (
$str!!) A
;!!A B

fileTarget"" 
."" 
ArchiveEvery"" #
=""$ %
FileArchivePeriod""& 7
.""7 8
Day""8 ;
;""; <

fileTarget## 
.## 
ArchiveNumbering## '
=##( ) 
ArchiveNumberingMode##* >
.##> ?
Date##? C
;##C D

fileTarget$$ 
.$$ 
MaxArchiveFiles$$ &
=$$' (
$num$$) *
;$$* +

fileTarget%% 
.%% 
KeepFileOpen%% #
=%%$ %
false%%& +
;%%+ ,

fileTarget&& 
.&& 
ConcurrentWrites&& '
=&&( )
true&&* .
;&&. /
var** 
rule1** 
=** 
new** 
LoggingRule** '
(**' (
$str**( +
,**+ ,
LogLevel**- 5
.**5 6
Trace**6 ;
,**; <
consoleTarget**= J
)**J K
;**K L
config++ 
.++ 
LoggingRules++ 
.++  
Add++  #
(++# $
rule1++$ )
)++) *
;++* +
var-- 
rule2-- 
=-- 
new-- 
LoggingRule-- '
(--' (
$str--( +
,--+ ,
LogLevel--- 5
.--5 6
Trace--6 ;
,--; <

fileTarget--= G
)--G H
;--H I
config.. 
... 
LoggingRules.. 
...  
Add..  #
(..# $
rule2..$ )
)..) *
;..* +

LogManager11 
.11 
Configuration11 $
=11% &
config11' -
;11- .
_logger33 
=33 

LogManager33  
.33  !
	GetLogger33! *
(33* +
$str33+ B
)33B C
;33C D
}>> 	
public@@ 
static@@ 
void@@ 
Fatal@@  
(@@  !
string@@! '
msg@@( +
)@@+ ,
{AA 	
_loggerBB 
.BB 
FatalBB 
(BB 
msgBB 
)BB 
;BB 
}CC 	
publicEE 
staticEE 
voidEE 
LogEE 
(EE 
stringEE %
msgEE& )
)EE) *
{FF 	
_loggerGG 
.GG 
DebugGG 
(GG 
msgGG 
)GG 
;GG 
}HH 	
publicJJ 
staticJJ 
voidJJ 
TraceJJ  
(JJ  !
stringJJ! '
msgJJ( +
)JJ+ ,
{KK 	
_loggerLL 
.LL 
TraceLL 
(LL 
msgLL 
)LL 
;LL 
}MM 	
}NN 
}OO û
@D:\Dev\AspNetCoreTestes\SharedKernel\Queries\PaginatedResults.cs
	namespace 	
Domain
 
. 
SharedKernel 
. 
Queries %
{ 
public 

sealed 
class 
PaginatedResults (
<( )
T) *
>* +
{ 
public		 
int		 
TotalRecords		 
{		  !
get		" %
;		% &
private		' .
set		/ 2
;		2 3
}		4 5
public

 
int

 
CurrentPage

 
{

  
get

! $
;

$ %
private

& -
set

. 1
;

1 2
}

3 4
public 
int 

TotalPages 
{ 
get  #
;# $
private% ,
set- 0
;0 1
}2 3
public 
int 
RecordsPerPage !
{" #
get$ '
;' (
private) 0
set1 4
;4 5
}6 7
public 
IList 
< 
T 
> 
Results 
{  !
get" %
;% &
private' .
set/ 2
;2 3
}4 5
public 
PaginatedResults 
(  
IList  %
<% &
T& '
>' (
results) 0
,0 1
int2 5
totalRecords6 B
,B C
intD G
currentPageH S
,S T
intU X
recordsPerPageY g
)g h
{ 	
Results 
= 
results 
; 
CurrentPage 
= 
currentPage %
;% &
TotalRecords 
= 
totalRecords '
;' (
RecordsPerPage 
= 
recordsPerPage +
;+ ,

TotalPages 
= 
( 
int 
) 
Math "
." #
Ceiling# *
(* +
(+ ,
double, 2
)2 3
TotalRecords3 ?
/@ A
RecordsPerPageB P
)P Q
;Q R
} 	
} 
} à
?D:\Dev\AspNetCoreTestes\SharedKernel\Queries\PaginationInput.cs
	namespace 	
Domain
 
. 
SharedKernel 
. 
Queries %
{ 
public 

sealed 
class 
PaginationInput '
{		 
public

 
PaginationInput

 
(

 
int

 "
currentPage

# .
,

. /
int

0 3
recordsPerPage

4 B
)

B C
{ 	
new 
Guard 
( 
) 
. 
GreaterThan 
( 
$str *
,* +
currentPage, 7
,7 8
$num9 :
): ;
. 
GreaterThan 
( 
$str -
,- .
recordsPerPage/ =
,= >
$num? @
)@ A
. 
Validate 
( 
) 
; 
CurrentPage 
= 
currentPage %
;% &
RecordsPerPage 
= 
recordsPerPage +
;+ ,
} 	
public 
int 
CurrentPage 
{  
get! $
;$ %
private& -
set. 1
;1 2
}3 4
public 
int 
RecordsPerPage !
{" #
get$ '
;' (
private) 0
set1 4
;4 5
}6 7
public 
int 
RecordsToSkip  
=>! #
($ %
CurrentPage% 0
-1 2
$num3 4
)4 5
*6 7
RecordsPerPage8 F
;F G
} 
} ä"
6D:\Dev\AspNetCoreTestes\SharedKernel\Utils\Comparer.cs
	namespace 	
Domain
 
. 
SharedKernel 
. 
Utils #
{ 
public

 
static

 
class

 
Comparer

 
{ 
public 
static 
bool 

TryCompare %
(% &
IComparable& 1
value2 7
,7 8
IComparable9 D
valueToCompareE S
,S T
outU X
intY \
result] c
)c d
{ 	
try 
{ 
Compare 
( 
value 
, 
valueToCompare -
,- .
out/ 2
result3 9
)9 :
;: ;
return 
true 
; 
} 
catch 
{ 
result 
= 
$num 
; 
} 
return 
false 
; 
}   	
static(( 
void(( 
Compare(( 
((( 
IComparable(( '
value((( -
,((- .
IComparable((/ :
valueToCompare((; I
,((I J
out((K N
int((O R
result((S Y
)((Y Z
{)) 	
try** 
{++ 
result-- 
=-- 
value-- 
.-- 
	CompareTo-- (
(--( )
valueToCompare--) 7
)--7 8
;--8 9
}.. 
catch// 
(// 
ArgumentException// $
)//$ %
{00 
if22 
(22 
value22 
is22 
decimal22 $
||22% '
valueToCompare22( 6
is227 9
decimal22: A
||22B D
value33 
is33 
double33 #
||33$ &
valueToCompare33' 5
is336 8
double339 ?
||33@ B
value44 
is44 
float44 "
||44# %
valueToCompare44& 4
is445 7
float448 =
)44= >
{55 
result77 
=77 
Convert77 $
.77$ %
ToDouble77% -
(77- .
value77. 3
)773 4
.774 5
	CompareTo775 >
(77> ?
Convert77? F
.77F G
ToDouble77G O
(77O P
valueToCompare77P ^
)77^ _
)77_ `
;77` a
}88 
else99 
{:: 
result<< 
=<< 
(<< 
(<< 
long<< #
)<<# $
value<<$ )
)<<) *
.<<* +
	CompareTo<<+ 4
(<<4 5
(<<5 6
long<<6 :
)<<: ;
valueToCompare<<; I
)<<I J
;<<J K
}== 
}>> 
}?? 	
publicEE 
staticEE 
intEE 
GetComparisonResultEE -
(EE- .
IComparableEE. 9
valueEE: ?
,EE? @
IComparableEEA L
valueToCompareEEM [
)EE[ \
{FF 	
intGG 
resultGG 
;GG 
ifHH 
(HH 

TryCompareHH 
(HH 
valueHH  
,HH  !
valueToCompareHH" 0
,HH0 1
outHH2 5
resultHH6 <
)HH< =
)HH= >
{II 
returnJJ 
resultJJ 
;JJ 
}KK 
returnMM 
valueMM 
.MM 
	CompareToMM "
(MM" #
valueToCompareMM# 1
)MM1 2
;MM2 3
}NN 	
publicTT 
staticTT 
boolTT 
GetEqualsResultTT *
(TT* +
IComparableTT+ 6
valueTT7 <
,TT< =
IComparableTT> I
valueToCompareTTJ X
)TTX Y
{UU 	
intVV 
resultVV 
;VV 
ifWW 
(WW 

TryCompareWW 
(WW 
valueWW  
,WW  !
valueToCompareWW" 0
,WW0 1
outWW2 5
resultWW6 <
)WW< =
)WW= >
{XX 
returnYY 
resultYY 
==YY  
$numYY! "
;YY" #
}ZZ 
return\\ 
value\\ 
.\\ 
Equals\\ 
(\\  
valueToCompare\\  .
)\\. /
;\\/ 0
}]] 	
}^^ 
}__ §

FD:\Dev\AspNetCoreTestes\SharedKernel\Validation\FieldValidationInfo.cs
	namespace 	
Domain
 
. 
SharedKernel 
. 

Validation (
{ 
public 

class 
FieldValidationInfo $
{ 
public		 
string		 
Field		 
{		 
get		 !
;		! "
private		# *
set		+ .
;		. /
}		0 1
public

 
string

 
Message

 
{

 
get

  #
;

# $
private

% ,
set

- 0
;

0 1
}

2 3
public 
bool 
IsValid 
{ 
get !
;! "
private# *
set+ .
;. /
}0 1
public 
FieldValidationInfo "
(" #
string# )
field* /
,/ 0
string1 7
message8 ?
,? @
boolA E
isValidF M
)M N
{ 	
Field 
= 
field 
; 
IsValid 
= 
isValid 
; 
Message 
= 
message 
; 
} 	
} 
} œC
8D:\Dev\AspNetCoreTestes\SharedKernel\Validation\Guard.cs
	namespace		 	
Domain		
 
.		 
SharedKernel		 
.		 

Validation		 (
{

 
public 

class 
Guard 
{ 
private 
IList 
< 
FieldValidationInfo )
>) *
validations+ 6
;6 7
public 
Guard 
( 
) 
{ 	
validations 
= 
new 
List "
<" #
FieldValidationInfo# 6
>6 7
(7 8
)8 9
;9 :
} 	
public 
void 
Validate 
( 
string #
message$ +
=, -
$str. ?
)? @
{ 	
if 
( 
validations 
. 
Any 
(  
x  !
=>" $
!% &
x& '
.' (
IsValid( /
)/ 0
)0 1
throw 
new %
FieldsValidationException 3
(3 4
message4 ;
,; <
validations= H
.H I
WhereI N
(N O
cO P
=>Q S
!T U
cU V
.V W
IsValidW ^
)^ _
._ `
ToList` f
(f g
)g h
)h i
;i j
} 	
public 
Guard 
NotNull 
( 
string #
field$ )
,) *
object+ 1
obj2 5
)5 6
{ 	
if 
( 
obj 
== 
null 
) 
validations 
. 
Add 
(  
new  #
FieldValidationInfo$ 7
(7 8
field8 =
,= >
$"? A
O campo A I
{I J
fieldJ O
}O P
 Ã© obrigatÃ³rioP ^
"^ _
,_ `
falsea f
)f g
)g h
;h i
else 
validations 
. 
Add 
(  
ValidationOK  ,
(, -
)- .
). /
;/ 0
return!! 
this!! 
;!! 
}"" 	
public$$ 
Guard$$ 
NotNullOrEmpty$$ #
($$# $
string$$$ *
field$$+ 0
,$$0 1
string$$2 8
value$$9 >
)$$> ?
{%% 	
if&& 
(&& 
string&& 
.&& 
IsNullOrEmpty&& $
(&&$ %
value&&% *
)&&* +
)&&+ ,
validations'' 
.'' 
Add'' 
(''  
new''  #
FieldValidationInfo''$ 7
(''7 8
field''8 =
,''= >
$"''? A
O campo ''A I
{''I J
field''J O
}''O P 
 nÃ£o pode ser vazio''P c
"''c d
,''d e
false''f k
)''k l
)''l m
;''m n
else(( 
validations)) 
.)) 
Add)) 
())  
ValidationOK))  ,
()), -
)))- .
))). /
;))/ 0
return++ 
this++ 
;++ 
},, 	
public.. 
Guard.. 
GreaterThan..  
(..  !
string..! '
field..( -
,..- .
IComparable../ :
number..; A
,..A B
IComparable..C N
greaterThanNumber..O `
)..` a
{// 	
if00 
(00 
Comparer00 
.00 
GetComparisonResult00 ,
(00, -
number00- 3
,003 4
greaterThanNumber005 F
)00F G
>00H I
$num00J K
)00K L
validations11 
.11 
Add11 
(11  
ValidationOK11  ,
(11, -
)11- .
)11. /
;11/ 0
else22 
validations33 
.33 
Add33 
(33  
new33  #
FieldValidationInfo33$ 7
(337 8
field338 =
,33= >
$"33? A
O campo 33A I
{33I J
field33J O
}33O P#
 deve ser maior do que 33P g
{33g h
greaterThanNumber33h y
}33y z
.33z {
"33{ |
,33| }
false	33~ ƒ
)
33ƒ „
)
33„ …
;
33… †
return55 
this55 
;55 
}77 	
public99 
Guard99 
LessThan99 
(99 
string99 $
field99% *
,99* +
IComparable99, 7
number998 >
,99> ?
IComparable99@ K
lessThanNumber99L Z
)99Z [
{:: 	
if;; 
(;; 
Comparer;; 
.;; 
GetComparisonResult;; ,
(;;, -
number;;- 3
,;;3 4
lessThanNumber;;5 C
);;C D
<;;E F
$num;;G H
);;H I
validations<< 
.<< 
Add<< 
(<<  
ValidationOK<<  ,
(<<, -
)<<- .
)<<. /
;<</ 0
else== 
validations>> 
.>> 
Add>> 
(>>  
new>>  #
FieldValidationInfo>>$ 7
(>>7 8
field>>8 =
,>>= >
$">>? A
O campo >>A I
{>>I J
field>>J O
}>>O P#
 deve ser menor do que >>P g
{>>g h
lessThanNumber>>h v
}>>v w
.>>w x
">>x y
,>>y z
false	>>{ €
)
>>€ 
)
>> ‚
;
>>‚ ƒ
return@@ 
this@@ 
;@@ 
}BB 	
publicDD 
GuardDD 

ValidEmailDD 
(DD  
stringDD  &
fieldDD' ,
,DD, -
stringDD. 4
emailDD5 :
)DD: ;
{EE 	
stringFF 

expressionFF 
=FF 
$str	FF  ¯
;
FF¯ °
varHH 
regexHH 
=HH 
newHH 
RegexHH !
(HH! "

expressionHH" ,
,HH, -
RegexOptionsHH. :
.HH: ;

IgnoreCaseHH; E
)HHE F
;HHF G
ifJJ 
(JJ 
!JJ 
regexJJ 
.JJ 
IsMatchJJ 
(JJ 
emailJJ $
)JJ$ %
)JJ% &
validationsKK 
.KK 
AddKK 
(KK  
newKK  #
FieldValidationInfoKK$ 7
(KK7 8
fieldKK8 =
,KK= >
$strKK? V
,KKV W
falseKKX ]
)KK] ^
)KK^ _
;KK_ `
elseLL 
validationsMM 
.MM 
AddMM 
(MM  
ValidationOKMM  ,
(MM, -
)MM- .
)MM. /
;MM/ 0
returnOO 
thisOO 
;OO 
}PP 	
publicRR 
GuardRR 
HasMoreThanOneRR #
<RR# $
TRR$ %
>RR% &
(RR& '
stringRR' -
fieldRR. 3
,RR3 4
IListRR5 :
<RR: ;
TRR; <
>RR< =
listaRR> C
)RRC D
{SS 	
ifTT 
(TT 
listaTT 
==TT 
nullTT 
||TT 
listaTT  %
.TT% &
CountTT& +
==TT, .
$numTT/ 0
)TT0 1
validationsUU 
.UU 
AddUU 
(UU  
newUU  #
FieldValidationInfoUU$ 7
(UU7 8
fieldUU8 =
,UU= >
$"UU? A
A lista UUA I
{UUI J
fieldUUJ O
}UUO P"
 nÃ£o pode estar vaziaUUP e
"UUe f
,UUf g
falseUUh m
)UUm n
)UUn o
;UUo p
elseVV 
validationsWW 
.WW 
AddWW 
(WW  
ValidationOKWW  ,
(WW, -
)WW- .
)WW. /
;WW/ 0
returnYY 
thisYY 
;YY 
}ZZ 	
private]] 
FieldValidationInfo]] #
ValidationOK]]$ 0
(]]0 1
)]]1 2
{^^ 	
return__ 
new__ 
FieldValidationInfo__ *
(__* +
$str__+ -
,__- .
$str__/ 1
,__1 2
true__3 7
)__7 8
;__8 9
}`` 	
}bb 
}cc 