‰
8D:\Dev\AspNetCoreTestes\Repositories\ClienteRepositoy.cs
	namespace 	
Repositories
 
{ 
public 

class 
ClienteRepository "
:# $

Repository% /
</ 0
Cliente0 7
,7 8
LojaContext9 D
>D E
,E F
IClienteRepositoryG Y
{ 
public		 
ClienteRepository		  
(		  !
LojaContext		! ,
context		- 4
)		4 5
:		6 7
base		8 <
(		< =
context		= D
)		D E
{

 	
} 	
} 
} ·
=D:\Dev\AspNetCoreTestes\Repositories\Contexts\AdminContext.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
{ 
public 

class 
AdminContext 
: 
	DbContext  )
{ 
public 
DbSet 
< 
Usuario 
> 
Usuarios &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
AdminContext 
( 
DbContextOptions ,
<, -
AdminContext- 9
>9 :
options; B
)B C
:D E
baseF J
(J K
optionsK R
)R S
=>T V
ChangeTracker 
. !
QueryTrackingBehavior /
=0 1!
QueryTrackingBehavior2 G
.G H

NoTrackingH R
;R S
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
.  
AddDefaultProperties %
(% &
)& '
. 
Entity 
< 
Usuario 
>  
(  !
entity! '
=>( *
{ 
entity 
. 
ToTable 
( 
$str &
)& '
. 
AddIsDeletedFilter '
(' (
)( )
. 
HasIndex 
( 
c 
=>  "
c# $
.$ %
Email% *
)* +
.+ ,
IsUnique, 4
(4 5
)5 6
;6 7
}   
)   
;   
}## 	
public'' 
override'' 
int'' 
SaveChanges'' '
(''' (
)''( )
{(( 	#
DefaultPropertiesConfig)) #
.))# $(
SaveDefaultPropertiesChanges))$ @
())@ A
ChangeTracker))A N
)))N O
;))O P
return** 
base** 
.** 
SaveChanges** #
(**# $
)**$ %
;**% &
}++ 	
},, 
}-- ô
MD:\Dev\AspNetCoreTestes\Repositories\Contexts\Config\AdminDbContextFactory.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
{ 
public 

class !
AdminDbContextFactory &
:' ('
IDesignTimeDbContextFactory) D
<D E
AdminContextE Q
>Q R
{ 
public 
AdminContext 
CreateDbContext +
(+ ,
string, 2
[2 3
]3 4
args5 9
)9 :
{		 	
var

 
builder

 
=

 
new

 #
DbContextOptionsBuilder

 5
<

5 6
AdminContext

6 B
>

B C
(

C D
)

D E
;

E F
builder 
. 
UseSqlServer  
(  !
$str! |
)| }
;} ~
return 
new 
AdminContext #
(# $
builder$ +
.+ ,
Options, 3
)3 4
;4 5
} 	
} 
} å!
OD:\Dev\AspNetCoreTestes\Repositories\Contexts\Config\DefaultPropertiesConfig.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
.% &
Config& ,
{		 
public

 

static

 
class

 #
DefaultPropertiesConfig

 /
{ 
internal 
static 
ModelBuilder $ 
AddDefaultProperties% 9
(9 :
this: >
ModelBuilder? K
modelBuilderL X
)X Y
{ 	
foreach 
( 
var 

entityType #
in$ &
modelBuilder' 3
.3 4
Model4 9
.9 :
GetEntityTypes: H
(H I
)I J
)J K
{ 
modelBuilder 
. 
Entity #
(# $

entityType$ .
.. /
Name/ 3
)3 4
.4 5
Property5 =
<= >
DateTime> F
>F G
(G H
$strH V
)V W
;W X
modelBuilder 
. 
Entity #
(# $

entityType$ .
.. /
Name/ 3
)3 4
.4 5
Property5 =
<= >
bool> B
>B C
(C D
$strD O
)O P
;P Q
} 
return 
modelBuilder 
;  
} 	
internal 
static 
EntityTypeBuilder )
<) *
T* +
>+ ,
AddIsDeletedFilter- ?
<? @
T@ A
>A B
(B C
thisC G
EntityTypeBuilderH Y
<Y Z
TZ [
>[ \
entityTypeBuilder] n
)n o
wherep u
Tv w
:w x
Entityx ~
{ 	
entityTypeBuilder 
. 
HasQueryFilter ,
(, -
c- .
=>/ 1
!2 3
EF3 5
.5 6
Property6 >
<> ?
bool? C
>C D
(D E
cE F
,F G
$strH S
)S T
)T U
;U V
return 
entityTypeBuilder $
;$ %
} 	
internal 
static 
void (
SaveDefaultPropertiesChanges 9
(9 :
ChangeTracker: G
changeTrackerH U
)U V
{ 	
foreach 
( 
var 
entry 
in !
changeTracker" /
./ 0
Entries0 7
(7 8
)8 9
.   
Where   
(   
e   
=>   
e   
.   
State    
==  ! #
EntityState  $ /
.  / 0
Added  0 5
||  6 8
e!! 
.!! 
State!!  
==!!! #
EntityState!!$ /
.!!/ 0
Modified!!0 8
)!!8 9
)!!9 :
{"" 
entry## 
.## 
Property## 
(## 
$str## -
)##- .
.##. /
CurrentValue##/ ;
=##< =
DateTime##> F
.##F G
Now##G J
;##J K
}$$ 
foreach&& 
(&& 
var&& 
entry&& 
in&& !
changeTracker&&" /
.&&/ 0
Entries&&0 7
(&&7 8
)&&8 9
.'' 
Where'' 
('' 
p'' 
=>'' 
p'' 
.'' 
State'' !
==''" $
EntityState''% 0
.''0 1
Deleted''1 8
&&(( 
p(( 
.(( 
Entity(( 
is(( 
Entity(( #
)((# $
)(($ %
{)) 
entry** 
.** 
Property** 
(** 
$str** *
)*** +
.**+ ,
CurrentValue**, 8
=**9 :
true**; ?
;**? @
entry++ 
.++ 
State++ 
=++ 
EntityState++ )
.++) *
Modified++* 2
;++2 3
},, 
}-- 	
}.. 
}// î
LD:\Dev\AspNetCoreTestes\Repositories\Contexts\Config\LojaDbContextFactory.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
{ 
public 

class  
LojaDbContextFactory %
:& ''
IDesignTimeDbContextFactory( C
<C D
LojaContextD O
>O P
{ 
public 
LojaContext 
CreateDbContext *
(* +
string+ 1
[1 2
]2 3
args4 8
)8 9
{		 	
var

 
builder

 
=

 
new

 #
DbContextOptionsBuilder

 5
<

5 6
LojaContext

6 A
>

A B
(

B C
)

C D
;

D E
builder 
. 
UseSqlServer  
(  !
$str! |
)| }
;} ~
return 
new 
LojaContext "
(" #
builder# *
.* +
Options+ 2
)2 3
;3 4
} 	
} 
} ¶	
XD:\Dev\AspNetCoreTestes\Repositories\Contexts\Config\TenantManagementDbContextFactory.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
{ 
public 

class ,
 TenantManagementDbContextFactory 1
:2 3'
IDesignTimeDbContextFactory4 O
<O P#
TenantManagementContextP g
>g h
{ 
public #
TenantManagementContext &
CreateDbContext' 6
(6 7
string7 =
[= >
]> ?
args@ D
)D E
{		 	
var

 
builder

 
=

 
new

 #
DbContextOptionsBuilder

 5
<

5 6#
TenantManagementContext

6 M
>

M N
(

N O
)

O P
;

P Q
builder 
. 
UseSqlServer  
(  !
$str! |
)| }
;} ~
return 
new #
TenantManagementContext .
(. /
builder/ 6
.6 7
Options7 >
)> ?
;? @
} 	
} 
} õ
<D:\Dev\AspNetCoreTestes\Repositories\Contexts\LojaContext.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
{ 
public 

class 
LojaContext 
: 
	DbContext (
{ 
public 
DbSet 
< 
Cliente 
> 
Clientes &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
DbSet 
< 
Pedido 
> 
Pedidos $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DbSet 
< 
Produto 
> 
Produto %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
DbSet 
< 
ItensPedido  
>  !

ItemPedido" ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
public 
LojaContext 
( 
DbContextOptions +
<+ ,
LojaContext, 7
>7 8
options9 @
)@ A
:B C
baseD H
(H I
optionsI P
)P Q
=>R T
ChangeTracker 
. !
QueryTrackingBehavior /
=0 1!
QueryTrackingBehavior2 G
.G H

NoTrackingH R
;R S
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
.  
AddDefaultProperties %
(% &
)& '
. 
Entity 
< 
Cliente 
>  
(  !
entity! '
=>( *
{ 
entity 
. 
ToTable 
( 
$str &
)& '
.   
AddIsDeletedFilter   '
(  ' (
)  ( )
;  ) *
}!! 
)!! 
.## 
Entity## 
<## 
Pedido## 
>## 
(##  
entity##  &
=>##' )
{$$ 
entity%% 
.&& 
ToTable&& 
(&& 
$str&& %
)&&% &
.'' 
AddIsDeletedFilter'' '
(''' (
)''( )
;'') *
}(( 
)(( 
.** 
Entity** 
<** 
Produto** 
>**  
(**  !
entity**! '
=>**( *
{++ 
entity,, 
.-- 
ToTable-- 
(-- 
$str-- &
)--& '
... 
AddIsDeletedFilter.. '
(..' (
)..( )
;..) *
}// 
)// 
.11 
Entity11 
<11 
ItensPedido11 #
>11# $
(11$ %
entity11% +
=>11, .
{22 
entity33 
.44 
ToTable44 
(44 
$str44 )
)44) *
.55 
HasKey55 
(55 
x55 
=>55  
new55! $
{55% &
x55' (
.55( )
PedidoId55) 1
,551 2
x553 4
.554 5
	ProdutoId555 >
}55? @
)55@ A
;55A B
}66 
)66 
;77 
}99 	
public== 
override== 
int== 
SaveChanges== '
(==' (
)==( )
{>> 	#
DefaultPropertiesConfig@@ #
.@@# $(
SaveDefaultPropertiesChanges@@$ @
(@@@ A
ChangeTracker@@A N
)@@N O
;@@O P
returnAA 
baseAA 
.AA 
SaveChangesAA #
(AA# $
)AA$ %
;AA% &
}BB 	
}CC 
}DD â
HD:\Dev\AspNetCoreTestes\Repositories\Contexts\TenantManagementContext.cs
	namespace 	
Infra
 
. 
Repositories 
. 
Contexts %
{		 
public

 

class

 #
TenantManagementContext

 (
:

) *
	DbContext

+ 4
{ 
public 
DbSet 
< 
Tenant 
> 
Tenants $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public #
TenantManagementContext &
(& '
DbContextOptions' 7
<7 8#
TenantManagementContext8 O
>O P
optionsQ X
)X Y
:Z [
base\ `
(` a
optionsa h
)h i
=>j l
ChangeTracker 
. !
QueryTrackingBehavior /
=0 1!
QueryTrackingBehavior2 G
.G H

NoTrackingH R
;R S
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
.  
AddDefaultProperties %
(% &
)& '
. 
Entity 
< 
Tenant 
> 
(  
entity  &
=>' )
{ 
entity 
. 
ToTable 
( 
$str %
)% &
.   
AddIsDeletedFilter   '
(  ' (
)  ( )
.!! 
HasIndex!! 
(!! 
c!! 
=>!!  "
c!!# $
.!!$ %
Dominio!!% ,
)!!, -
.!!- .
IsUnique!!. 6
(!!6 7
)!!7 8
;!!8 9
}## 
)## 
;## 
}&& 	
public** 
override** 
int** 
SaveChanges** '
(**' (
)**( )
{++ 	#
DefaultPropertiesConfig,, #
.,,# $(
SaveDefaultPropertiesChanges,,$ @
(,,@ A
ChangeTracker,,A N
),,N O
;,,O P
return-- 
base-- 
.-- 
SaveChanges-- #
(--# $
)--$ %
;--% &
}.. 	
}// 
}00 ƒ
MD:\Dev\AspNetCoreTestes\Repositories\EventHandlers\UserCreatedEventHandler.cs
	namespace 	
Repositories
 
. 
EventHandlers $
{ 
public 

class #
UserCreatedEventHandler (
:) *
IHandle+ 2
<2 3
UsuarioCriadoEvent3 E
>E F
{ 
public		 
void		 
Handle		 
(		 
UsuarioCriadoEvent		 -
args		. 2
)		2 3
{

 	
Logger 
. 
Log 
( 
$" G
;Peguei o User Created Event No Repositorio. O usuario Ã© o  S
{S T
argsT X
.X Y
UsuarioY `
.` a
Nomea e
}e f
.f g
"g h
)h i
;i j
} 	
} 
} 
FD:\Dev\AspNetCoreTestes\Repositories\Migrations\20170901175758_init.cs
	namespace 	
Infra
 
. 
Repositories 
. 

Migrations '
{ 
public 

partial 
class 
init 
: 
	Migration  )
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ G
,G H,
 SqlServerValueGenerationStrategyI i
.i j
IdentityColumnj x
)x y
,y z
	IsDeleted 
= 
table  %
.% &
Column& ,
<, -
bool- 1
>1 2
(2 3
type3 7
:7 8
$str9 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
LastModified  
=! "
table# (
.( )
Column) /
</ 0
DateTime0 8
>8 9
(9 :
type: >
:> ?
$str@ K
,K L
nullableM U
:U V
falseW \
)\ ]
,] ^
Nome 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
trueQ U
)U V
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Id: <
)< =
;= >
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
)  
;  !
} 	
}   
}!! Ô
[D:\Dev\AspNetCoreTestes\Repositories\Migrations\20170906155331_AddEmailAndPasswordToUser.cs
	namespace 	
Infra
 
. 
Repositories 
. 

Migrations '
{ 
public 

partial 
class %
AddEmailAndPasswordToUser 2
:3 4
	Migration5 >
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
	AddColumn		 &
<		& '
string		' -
>		- .
(		. /
name

 
:

 
$str

 
,

 
table 
: 
$str  
,  !
type 
: 
$str %
,% &
nullable 
: 
true 
) 
;  
migrationBuilder 
. 
	AddColumn &
<& '
string' -
>- .
(. /
name 
: 
$str 
, 
table 
: 
$str  
,  !
type 
: 
$str %
,% &
nullable 
: 
true 
) 
;  
migrationBuilder 
. 
CreateIndex (
(( )
name 
: 
$str (
,( )
table 
: 
$str  
,  !
column 
: 
$str 
,  
unique 
: 
true 
, 
filter 
: 
$str -
)- .
;. /
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropIndex &
(& '
name   
:   
$str   (
,  ( )
table!! 
:!! 
$str!!  
)!!  !
;!!! "
migrationBuilder## 
.## 

DropColumn## '
(##' (
name$$ 
:$$ 
$str$$ 
,$$ 
table%% 
:%% 
$str%%  
)%%  !
;%%! "
migrationBuilder'' 
.'' 

DropColumn'' '
(''' (
name(( 
:(( 
$str(( 
,(( 
table)) 
:)) 
$str))  
)))  !
;))! "
}** 	
}++ 
},, ”
QD:\Dev\AspNetCoreTestes\Repositories\Migrations\20170906180444_PerfilDoUsuario.cs
	namespace 	
Infra
 
. 
Repositories 
. 

Migrations '
{ 
public 

partial 
class 
PerfilDoUsuario (
:) *
	Migration+ 4
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
	AddColumn		 &
<		& '
byte		' +
>		+ ,
(		, -
name

 
:

 
$str

 
,

 
table 
: 
$str  
,  !
type 
: 
$str 
,  
nullable 
: 
false 
,  
defaultValue 
: 
( 
byte #
)# $
$num$ %
)% &
;& '
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str 
, 
table 
: 
$str  
)  !
;! "
} 	
} 
} ‚a
KD:\Dev\AspNetCoreTestes\Repositories\Migrations\Loja\20170901183731_init.cs
	namespace 	
Infra
 
. 
Repositories 
. 

Migrations '
.' (
Loja( ,
{ 
public 

partial 
class 
init 
: 
	Migration  )
{ 
	protected		 
override		 
void		 
Up		  "
(		" #
MigrationBuilder		# 3
migrationBuilder		4 D
)		D E
{

 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ G
,G H,
 SqlServerValueGenerationStrategyI i
.i j
IdentityColumnj x
)x y
,y z
	IsDeleted 
= 
table  %
.% &
Column& ,
<, -
bool- 1
>1 2
(2 3
type3 7
:7 8
$str9 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
LastModified  
=! "
table# (
.( )
Column) /
</ 0
DateTime0 8
>8 9
(9 :
type: >
:> ?
$str@ K
,K L
nullableM U
:U V
falseW \
)\ ]
,] ^
Nome 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
trueQ U
)U V
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Id: <
)< =
;= >
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ G
,G H,
 SqlServerValueGenerationStrategyI i
.i j
IdentityColumnj x
)x y
,y z
	IsDeleted   
=   
table    %
.  % &
Column  & ,
<  , -
bool  - 1
>  1 2
(  2 3
type  3 7
:  7 8
$str  9 >
,  > ?
nullable  @ H
:  H I
false  J O
)  O P
,  P Q
LastModified!!  
=!!! "
table!!# (
.!!( )
Column!!) /
<!!/ 0
DateTime!!0 8
>!!8 9
(!!9 :
type!!: >
:!!> ?
$str!!@ K
,!!K L
nullable!!M U
:!!U V
false!!W \
)!!\ ]
,!!] ^
Nome"" 
="" 
table""  
.""  !
Column""! '
<""' (
string""( .
>"". /
(""/ 0
type""0 4
:""4 5
$str""6 E
,""E F
nullable""G O
:""O P
true""Q U
)""U V
,""V W
Preco## 
=## 
table## !
.##! "
Column##" (
<##( )
decimal##) 0
>##0 1
(##1 2
type##2 6
:##6 7
$str##8 H
,##H I
nullable##J R
:##R S
false##T Y
)##Y Z
}$$ 
,$$ 
constraints%% 
:%% 
table%% "
=>%%# %
{&& 
table'' 
.'' 

PrimaryKey'' $
(''$ %
$str''% 1
,''1 2
x''3 4
=>''5 7
x''8 9
.''9 :
Id'': <
)''< =
;''= >
}(( 
)(( 
;(( 
migrationBuilder** 
.** 
CreateTable** (
(**( )
name++ 
:++ 
$str++ 
,++ 
columns,, 
:,, 
table,, 
=>,, !
new,," %
{-- 
Id.. 
=.. 
table.. 
... 
Column.. %
<..% &
int..& )
>..) *
(..* +
type..+ /
:../ 0
$str..1 6
,..6 7
nullable..8 @
:..@ A
false..B G
)..G H
.// 

Annotation// #
(//# $
$str//$ G
,//G H,
 SqlServerValueGenerationStrategy//I i
.//i j
IdentityColumn//j x
)//x y
,//y z
	ClienteId00 
=00 
table00  %
.00% &
Column00& ,
<00, -
int00- 0
>000 1
(001 2
type002 6
:006 7
$str008 =
,00= >
nullable00? G
:00G H
true00I M
)00M N
,00N O
	IsDeleted11 
=11 
table11  %
.11% &
Column11& ,
<11, -
bool11- 1
>111 2
(112 3
type113 7
:117 8
$str119 >
,11> ?
nullable11@ H
:11H I
false11J O
)11O P
,11P Q
LastModified22  
=22! "
table22# (
.22( )
Column22) /
<22/ 0
DateTime220 8
>228 9
(229 :
type22: >
:22> ?
$str22@ K
,22K L
nullable22M U
:22U V
false22W \
)22\ ]
}33 
,33 
constraints44 
:44 
table44 "
=>44# %
{55 
table66 
.66 

PrimaryKey66 $
(66$ %
$str66% 0
,660 1
x662 3
=>664 6
x667 8
.668 9
Id669 ;
)66; <
;66< =
table77 
.77 

ForeignKey77 $
(77$ %
name88 
:88 
$str88 ;
,88; <
column99 
:99 
x99  !
=>99" $
x99% &
.99& '
	ClienteId99' 0
,990 1
principalTable:: &
:::& '
$str::( 1
,::1 2
principalColumn;; '
:;;' (
$str;;) -
,;;- .
onDelete<<  
:<<  !
ReferentialAction<<" 3
.<<3 4
Restrict<<4 <
)<<< =
;<<= >
}== 
)== 
;== 
migrationBuilder?? 
.?? 
CreateTable?? (
(??( )
name@@ 
:@@ 
$str@@ "
,@@" #
columnsAA 
:AA 
tableAA 
=>AA !
newAA" %
{BB 
PedidoIdCC 
=CC 
tableCC $
.CC$ %
ColumnCC% +
<CC+ ,
intCC, /
>CC/ 0
(CC0 1
typeCC1 5
:CC5 6
$strCC7 <
,CC< =
nullableCC> F
:CCF G
falseCCH M
)CCM N
,CCN O
	ProdutoIdDD 
=DD 
tableDD  %
.DD% &
ColumnDD& ,
<DD, -
intDD- 0
>DD0 1
(DD1 2
typeDD2 6
:DD6 7
$strDD8 =
,DD= >
nullableDD? G
:DDG H
falseDDI N
)DDN O
,DDO P
	IsDeletedEE 
=EE 
tableEE  %
.EE% &
ColumnEE& ,
<EE, -
boolEE- 1
>EE1 2
(EE2 3
typeEE3 7
:EE7 8
$strEE9 >
,EE> ?
nullableEE@ H
:EEH I
falseEEJ O
)EEO P
,EEP Q
LastModifiedFF  
=FF! "
tableFF# (
.FF( )
ColumnFF) /
<FF/ 0
DateTimeFF0 8
>FF8 9
(FF9 :
typeFF: >
:FF> ?
$strFF@ K
,FFK L
nullableFFM U
:FFU V
falseFFW \
)FF\ ]
,FF] ^

QuantidadeGG 
=GG  
tableGG! &
.GG& '
ColumnGG' -
<GG- .
intGG. 1
>GG1 2
(GG2 3
typeGG3 7
:GG7 8
$strGG9 >
,GG> ?
nullableGG@ H
:GGH I
falseGGJ O
)GGO P
}HH 
,HH 
constraintsII 
:II 
tableII "
=>II# %
{JJ 
tableKK 
.KK 

PrimaryKeyKK $
(KK$ %
$strKK% 4
,KK4 5
xKK6 7
=>KK8 :
newKK; >
{KK? @
xKKA B
.KKB C
PedidoIdKKC K
,KKK L
xKKM N
.KKN O
	ProdutoIdKKO X
}KKY Z
)KKZ [
;KK[ \
tableLL 
.LL 

ForeignKeyLL $
(LL$ %
nameMM 
:MM 
$strMM =
,MM= >
columnNN 
:NN 
xNN  !
=>NN" $
xNN% &
.NN& '
PedidoIdNN' /
,NN/ 0
principalTableOO &
:OO& '
$strOO( 0
,OO0 1
principalColumnPP '
:PP' (
$strPP) -
,PP- .
onDeleteQQ  
:QQ  !
ReferentialActionQQ" 3
.QQ3 4
CascadeQQ4 ;
)QQ; <
;QQ< =
tableRR 
.RR 

ForeignKeyRR $
(RR$ %
nameSS 
:SS 
$strSS ?
,SS? @
columnTT 
:TT 
xTT  !
=>TT" $
xTT% &
.TT& '
	ProdutoIdTT' 0
,TT0 1
principalTableUU &
:UU& '
$strUU( 1
,UU1 2
principalColumnVV '
:VV' (
$strVV) -
,VV- .
onDeleteWW  
:WW  !
ReferentialActionWW" 3
.WW3 4
CascadeWW4 ;
)WW; <
;WW< =
}XX 
)XX 
;XX 
migrationBuilderZZ 
.ZZ 
CreateIndexZZ (
(ZZ( )
name[[ 
:[[ 
$str[[ /
,[[/ 0
table\\ 
:\\ 
$str\\ #
,\\# $
column]] 
:]] 
$str]] #
)]]# $
;]]$ %
migrationBuilder__ 
.__ 
CreateIndex__ (
(__( )
name`` 
:`` 
$str`` +
,``+ ,
tableaa 
:aa 
$straa 
,aa  
columnbb 
:bb 
$strbb #
)bb# $
;bb$ %
}cc 	
	protectedee 
overrideee 
voidee 
Downee  $
(ee$ %
MigrationBuilderee% 5
migrationBuilderee6 F
)eeF G
{ff 	
migrationBuildergg 
.gg 
	DropTablegg &
(gg& '
namehh 
:hh 
$strhh "
)hh" #
;hh# $
migrationBuilderjj 
.jj 
	DropTablejj &
(jj& '
namekk 
:kk 
$strkk 
)kk 
;kk  
migrationBuildermm 
.mm 
	DropTablemm &
(mm& '
namenn 
:nn 
$strnn 
)nn  
;nn  !
migrationBuilderpp 
.pp 
	DropTablepp &
(pp& '
nameqq 
:qq 
$strqq 
)qq  
;qq  !
}rr 	
}ss 
}tt ¥'
dD:\Dev\AspNetCoreTestes\Repositories\Migrations\TenantManagement\20170908023856_InitTenantContext.cs
	namespace 	
Infra
 
. 
Repositories 
. 

Migrations '
.' (
TenantManagement( 8
{ 
public 

partial 
class 
InitTenantContext *
:+ ,
	Migration- 6
{		 
	protected

 
override

 
void

 
Up

  "
(

" #
MigrationBuilder

# 3
migrationBuilder

4 D
)

D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ G
,G H,
 SqlServerValueGenerationStrategyI i
.i j
IdentityColumnj x
)x y
,y z
Dominio 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
type3 7
:7 8
$str9 H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
EmailAdministrador &
=' (
table) .
.. /
Column/ 5
<5 6
string6 <
>< =
(= >
type> B
:B C
$strD S
,S T
nullableU ]
:] ^
true_ c
)c d
,d e
	IsDeleted 
= 
table  %
.% &
Column& ,
<, -
bool- 1
>1 2
(2 3
type3 7
:7 8
$str9 >
,> ?
nullable@ H
:H I
falseJ O
)O P
,P Q
LastModified  
=! "
table# (
.( )
Column) /
</ 0
DateTime0 8
>8 9
(9 :
type: >
:> ?
$str@ K
,K L
nullableM U
:U V
falseW \
)\ ]
,] ^
Nome 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 E
,E F
nullableG O
:O P
trueQ U
)U V
,V W
NomeAdministrador %
=& '
table( -
.- .
Column. 4
<4 5
string5 ;
>; <
(< =
type= A
:A B
$strC R
,R S
nullableT \
:\ ]
true^ b
)b c
,c d
Status 
= 
table "
." #
Column# )
<) *
byte* .
>. /
(/ 0
type0 4
:4 5
$str6 ?
,? @
nullableA I
:I J
falseK P
)P Q
,Q R
Tipo 
= 
table  
.  !
Column! '
<' (
byte( ,
>, -
(- .
type. 2
:2 3
$str4 =
,= >
nullable? G
:G H
falseI N
)N O
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 0
,0 1
x2 3
=>4 6
x7 8
.8 9
Id9 ;
); <
;< =
} 
) 
; 
migrationBuilder   
.   
CreateIndex   (
(  ( )
name!! 
:!! 
$str!! )
,!!) *
table"" 
:"" 
$str"" 
,""  
column## 
:## 
$str## !
,##! "
unique$$ 
:$$ 
true$$ 
,$$ 
filter%% 
:%% 
$str%% /
)%%/ 0
;%%0 1
}&& 	
	protected(( 
override(( 
void(( 
Down((  $
((($ %
MigrationBuilder((% 5
migrationBuilder((6 F
)((F G
{)) 	
migrationBuilder** 
.** 
	DropTable** &
(**& '
name++ 
:++ 
$str++ 
)++ 
;++  
},, 	
}-- 
}.. µ	
8D:\Dev\AspNetCoreTestes\Repositories\PedidoRepository.cs
	namespace 	
Repositories
 
{ 
public		 

class		 
PedidoRepository		 !
:		" #

Repository		$ .
<		. /
Pedido		/ 5
,		5 6
LojaContext		7 B
>		B C
,		C D
IPedidoRepository		E V
{

 
public 
PedidoRepository 
(  
LojaContext  +
context, 3
)3 4
:5 6
base7 ;
(; <
context< C
)C D
{ 	
} 	
public 
IList 
< 
Pedido 
> "
ObterPedidosPorCliente 3
(3 4
int4 7
	idCliente8 A
)A B
{ 	
return 
DbSet 
. 
Where 
( 
p  
=>! #
p$ %
.% &
Cliente& -
.- .
Id. 0
==1 3
	idCliente4 =
)= >
.> ?
ToList? E
(E F
)F G
;G H
} 	
} 
} ‰
8D:\Dev\AspNetCoreTestes\Repositories\ProdutoRepositoy.cs
	namespace 	
Repositories
 
{ 
public 

class 
ProdutoRepository "
:# $

Repository% /
</ 0
Produto0 7
,7 8
LojaContext9 D
>D E
,E F
IProdutoRepositoryG Y
{ 
public		 
ProdutoRepository		  
(		  !
LojaContext		! ,
context		- 4
)		4 5
:		6 7
base		8 <
(		< =
context		= D
)		D E
{

 	
} 	
} 
} ¯7
2D:\Dev\AspNetCoreTestes\Repositories\Repository.cs
	namespace

 	
Repositories


 
{ 
public 

abstract 
class 

Repository $
<$ %
TEntity% ,
,, -
TContext. 6
>6 7
:8 9
IRepository: E
<E F
TEntityF M
>M N
,N O
IDisposableP [
where 
TEntity 
: 
Entity 
where 
TContext 
: 
	DbContext "
{ 
	protected 
TContext 
Db 
; 
	protected 
DbSet 
< 
TEntity 
>  
DbSet! &
;& '
	protected 

Repository 
( 
TContext %
context& -
)- .
{ 	
Db 
= 
context 
; 
DbSet 
= 
Db 
. 
Set 
< 
TEntity "
>" #
(# $
)$ %
;% &
} 	
public 
virtual 
TEntity 
GetById &
(& '
int' *
id+ -
)- .
{ 	
return 
DbSet 
. 
AsNoTracking %
(% &
)& '
. 
FirstOrDefault 
(  
c  !
=>" $
c% &
.& '
Id' )
==* ,
id- /
)/ 0
;0 1
} 	
public 
IList 
< 
TEntity 
> 
GetAllBy &
(& '

Expression' 1
<1 2
Func2 6
<6 7
TEntity7 >
,> ?
bool@ D
>D E
>E F
	predicateG P
)P Q
{ 	
return   
DbSet   
.   
AsNoTracking   %
(  % &
)  & '
.!! 
Where!! 
(!! 
	predicate!!  
)!!  !
.!!! "
ToList!!" (
(!!( )
)!!) *
;!!* +
}"" 	
public$$ 
PaginatedResults$$ 
<$$  
TEntity$$  '
>$$' (
GetAllBy$$) 1
($$1 2

Expression$$2 <
<$$< =
Func$$= A
<$$A B
TEntity$$B I
,$$I J
bool$$K O
>$$O P
>$$P Q
	predicate$$R [
,$$[ \
PaginationInput$$] l
paginationInput$$m |
)$$| }
{%% 	
var&& 
count&& 
=&& 
DbSet&& 
.&& 
Where&& #
(&&# $
	predicate&&$ -
)&&- .
.&&. /
Count&&/ 4
(&&4 5
)&&5 6
;&&6 7
var(( 
results(( 
=(( 
DbSet(( 
.((  
AsNoTracking((  ,
(((, -
)((- .
.)) 
Where)) 
()) 
	predicate))  
)))  !
.** 
Skip** 
(** 
paginationInput** %
.**% &
RecordsToSkip**& 3
)**3 4
.++ 
Take++ 
(++ 
paginationInput++ %
.++% &
RecordsPerPage++& 4
)++4 5
.,, 
ToList,, 
(,, 
),, 
;,, 
return.. 
new.. 
PaginatedResults.. '
<..' (
TEntity..( /
>../ 0
(..0 1
results// 
:// 
results//  
,//  !
totalRecords00 
:00 
count00 #
,00# $
currentPage11 
:11 
paginationInput11 ,
.11, -
CurrentPage11- 8
,118 9
recordsPerPage22 
:22 
paginationInput22  /
.22/ 0
RecordsPerPage220 >
)22> ?
;22? @
}33 	
public55 
PaginatedResults55 
<55  
TEntity55  '
>55' (
GetAll55) /
(55/ 0
PaginationInput550 ?
paginationInput55@ O
)55O P
{66 	
var77 
count77 
=77 
DbSet77 
.77 
Count77 #
(77# $
)77$ %
;77% &
var99 
results99 
=99 
DbSet99 
.99  
AsNoTracking99  ,
(99, -
)99- .
.:: 
Skip:: 
(:: 
paginationInput:: %
.::% &
RecordsToSkip::& 3
)::3 4
.;; 
Take;; 
(;; 
paginationInput;; %
.;;% &
RecordsPerPage;;& 4
);;4 5
.<< 
ToList<< 
(<< 
)<< 
;<< 
return>> 
new>> 
PaginatedResults>> '
<>>' (
TEntity>>( /
>>>/ 0
(>>0 1
results?? 
:?? 
results??  
,??  !
totalRecords@@ 
:@@ 
count@@ #
,@@# $
currentPageAA 
:AA 
paginationInputAA ,
.AA, -
CurrentPageAA- 8
,AA8 9
recordsPerPageBB 
:BB 
paginationInputBB  /
.BB/ 0
RecordsPerPageBB0 >
)BB> ?
;BB? @
}CC 	
publicFF 
virtualFF 
voidFF 
InsertFF "
(FF" #
TEntityFF# *
entityFF+ 1
)FF1 2
{GG 	
DbSetHH 
.HH 
AddHH 
(HH 
entityHH 
)HH 
;HH 
DbII 
.II 
SaveChangesII 
(II 
)II 
;II 
}JJ 	
publicLL 
virtualLL 
voidLL 
UpdateLL "
(LL" #
TEntityLL# *
entityLL+ 1
)LL1 2
{MM 	
DbSetNN 
.NN 
UpdateNN 
(NN 
entityNN 
)NN  
;NN  !
DbOO 
.OO 
SaveChangesOO 
(OO 
)OO 
;OO 
}PP 	
publicRR 
virtualRR 
voidRR 
DeleteRR "
(RR" #
TEntityRR# *
entityRR+ 1
)RR1 2
{SS 	
DbSetTT 
.TT 
RemoveTT 
(TT 
entityTT 
)TT  
;TT  !
DbUU 
.UU 
SaveChangesUU 
(UU 
)UU 
;UU 
}VV 	
publicXX 
voidXX 
DisposeXX 
(XX 
)XX 
{YY 	
DbZZ 
.ZZ 
DisposeZZ 
(ZZ 
)ZZ 
;ZZ 
GC[[ 
.[[ 
SuppressFinalize[[ 
([[  
this[[  $
)[[$ %
;[[% &
}\\ 	
}^^ 
}__ ¾
8D:\Dev\AspNetCoreTestes\Repositories\TenantRepository.cs
	namespace 	
Repositories
 
{ 
public 

class 
TenantRepository !
:" #

Repository$ .
<. /
Tenant/ 5
,5 6#
TenantManagementContext7 N
>N O
,O P
ITenantRepositoryQ b
{		 
public

 
TenantRepository

 
(

  #
TenantManagementContext

  7
context

8 ?
)

? @
:

A B
base

C G
(

G H
context

H O
)

O P
{ 	
} 	
public 
Tenant 
ObterPeloDominio &
(& '
string' -
dominio. 5
)5 6
{ 	
return 
DbSet 
. 
FirstOrDefault '
(' (
c( )
=>* ,
c- .
.. /
Dominio/ 6
==7 9
dominio: A
)A B
;B C
} 	
} 
} ¢
9D:\Dev\AspNetCoreTestes\Repositories\UsuarioRepository.cs
	namespace 	
Repositories
 
{ 
public 

class 
UsuarioRepository "
:# $

Repository% /
</ 0
Usuario0 7
,7 8
AdminContext9 E
>E F
,F G
IUsuarioRepositoryH Z
{		 
public

 
UsuarioRepository

  
(

  !
AdminContext

! -
context

. 5
)

5 6
:

7 8
base

9 =
(

= >
context

> E
)

E F
{ 	
} 	
public 
Usuario 

GetByEmail !
(! "
string" (
email) .
). /
{ 	
return 
DbSet 
. 
FirstOrDefault '
(' (
u( )
=>* ,
u- .
.. /
Email/ 4
==5 7
email8 =
)= >
;> ?
} 	
} 
} 